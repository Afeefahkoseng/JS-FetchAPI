<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Add Cards — Fetch + Higher-Order Functions</title>
    <style>
        :root {
            --bg: #f4f6fb;
            --card: #ffffff;
            --accent: #3b82f6
        }

        body {
            font-family: Inter, system-ui, Segoe UI, Roboto, Arial;
            margin: 0;
            background: var(--bg);
            color: #0f172a
        }

        .wrap {
            max-width: 1000px;
            margin: 36px auto;
            padding: 20px
        }

        header {
            display: flex;
            gap: 12px;
            align-items: center;
            justify-content: space-between
        }

        h1 {
            margin: 0;
            font-size: 20px
        }

        .controls {
            display: flex;
            gap: 8px
        }

        button {
            background: var(--accent);
            border: none;
            color: #fff;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer
        }

        button.ghost {
            background: transparent;
            color: var(--accent);
            border: 1px solid rgba(59, 130, 246, 0.2)
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 16px;
            margin-top: 18px
        }

        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 12px;
            box-shadow: 0 6px 18px rgba(15, 23, 42, 0.06);
            display: flex;
            flex-direction: column;
            gap: 8px
        }

        .thumb {
            width: 100%;
            height: 120px;
            border-radius: 8px;
            object-fit: cover;
            background: linear-gradient(135deg, #e6eefc, #f8fafc)
        }

        .title {
            font-weight: 600
        }

        .meta {
            font-size: 13px;
            color: #475569
        }

        .small {
            font-size: 13px;
            color: #94a3b8
        }

        footer.note {
            margin-top: 12px;
            color: #475569;
            font-size: 13px
        }

        /* responsive */
        @media (max-width:520px) {
            header {
                flex-direction: column;
                align-items: flex-start
            }
        }
    </style>
</head>

<body>
    <div class="wrap">
        <header>
            <div>
                <h1>Live demo — สร้างการ์ดด้วย JavaScript (HOF) + Fetch API</h1>
                <p class="small">คลิกปุ่มด้านขวาเพื่อเพิ่มการ์ด: แบบสร้างจากข้อมูลในหน้า (ใช้ higher-order functions)
                    หรือดึงจาก API (Fetch)</p>
            </div>
            <div class="controls">
                <button id="add-local">Add card (HOF)</button>
                <button id="load-fetch" class="ghost">Load from Fetch API</button>
                <button id="clear" class="ghost">Clear</button>
            </div>
        </header>

        <section class="grid" id="cardGrid" aria-live="polite"></section>

        <footer class="note">
            ตัวอย่างนี้ใช้: map, forEach, filter (higher order functions) เพื่อแปลงข้อมูลเป็น DOM elements และใช้ Fetch
            API ดึง JSON จาก <code>jsonplaceholder.typicode.com</code>
        </footer>
    </div>

    <script>
        // ---------- Simple card template creator ----------
        const cardGrid = document.getElementById('cardGrid');

        // A small local dataset we will use with higher-order functions
        const localData = [
            { id: 1, title: 'Sunrise at Beach', desc: 'A quiet morning by the sea', img: 'https://images.unsplash.com/photo-1501973801540-537f08ccae7b?auto=format&fit=crop&w=800&q=60' },
            { id: 2, title: 'City Skyline', desc: 'Evening lights', img: 'https://images.unsplash.com/photo-1467269204594-9661b134dd2b?auto=format&fit=crop&w=800&q=60' },
            { id: 3, title: 'Misty Forest', desc: 'Walk through the fog', img: 'https://images.unsplash.com/photo-1501785888041-af3ef285b470?auto=format&fit=crop&w=800&q=60' }
        ];

        // Keep a running array of cards added (demonstrates use of array methods)
        let addedCards = [];

        // Create a DOM node for one card
        function createCardNode({ id, title, desc, img }) {
            const el = document.createElement('article');
            el.className = 'card';
            el.dataset.id = id;

            // Build inner HTML (small, safe template)
            el.innerHTML = `
        <img class="thumb" alt="${escapeHtml(title)}" src="${escapeHtml(img)}" loading="lazy">
        <div>
          <div class="title">${escapeHtml(title)}</div>
          <div class="meta">${escapeHtml(desc)}</div>
        </div>
      `;

            return el;
        }

        // Simple escape to avoid accidental HTML injection in this demo
        function escapeHtml(str) {
            return String(str)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;');
        }

        // ---------------- Higher-order function example ----------------
        // This function uses map + filter + forEach to add one or more cards
        function addLocalCards() {
            // Create variations of the local data (use map to transform)
            const nextIdBase = (addedCards.length ? addedCards[addedCards.length - 1].id : 100);

            // We will create 3 new items derived from localData using map
            const newItems = localData.map((item, idx) => ({
                // demonstrate map transformation
                id: nextIdBase + idx + 1,
                title: item.title + ' — copy ' + (addedCards.length + idx + 1),
                desc: item.desc,
                img: item.img
            }))
                // demonstrate filter (keep only those with id odd — just as an example)
                .filter(i => i.id % 2 === 1);

            // Save to state (concat)
            addedCards = addedCards.concat(newItems);

            // Use forEach (another HOF) to render each created node
            newItems.forEach(item => {
                const node = createCardNode(item);
                cardGrid.prepend(node); // show newest first
            });
        }

        // ---------------- Fetch API example ----------------
        async function loadFromFetch() {
            // indicate loading by disabling the button
            const btn = document.getElementById('load-fetch');
            btn.disabled = true;
            btn.textContent = 'Loading...';

            try {
                // We'll fetch a small list of photos from jsonplaceholder.typicode.com
                const res = await fetch('https://jsonplaceholder.typicode.com/photos?_limit=6');
                if (!res.ok) throw new Error('Network error');
                const photos = await res.json();

                // transform the fetched items using map (HOF) into our card shape
                const fetchedItems = photos.map(p => ({
                    id: p.id,
                    title: p.title.substring(0, 40),
                    desc: 'From FetchAPI — album ' + p.albumId,
                    img: p.thumbnailUrl.replace('150', '300') // try larger thumb
                }));

                // filter duplicates: only add items not already present
                const notAdded = fetchedItems.filter(fi => !addedCards.some(a => a.id === fi.id));

                // append to state and render
                addedCards = addedCards.concat(notAdded);
                notAdded.forEach(item => cardGrid.appendChild(createCardNode(item)));
            } catch (err) {
                console.error(err);
                alert('Failed to load from API — check console');
            } finally {
                btn.disabled = false;
                btn.textContent = 'Load from Fetch API';
            }
        }

        // Clear
        function clearAll() {
            addedCards = [];
            cardGrid.innerHTML = '';
        }

        // Wire UI
        document.getElementById('add-local').addEventListener('click', addLocalCards);
        document.getElementById('load-fetch').addEventListener('click', loadFromFetch);
        document.getElementById('clear').addEventListener('click', clearAll);

        // Accessibility: keyboard support (Enter/Space on buttons is default) and ARIA-live for updates

        // Optional: show an initial hint card
        (function seed() {
            const seed = { id: 0, title: 'Welcome — ทดลองคลิกได้', desc: 'กด Add card หรือ Load from Fetch API เพื่อเพิ่มการ์ด', img: 'https://images.unsplash.com/photo-1506976785307-8732e854ad76?auto=format&fit=crop&w=800&q=60' };
            addedCards.push(seed);
            cardGrid.appendChild(createCardNode(seed));
        })();

    </script>
</body>

</html>